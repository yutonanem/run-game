<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Poop Runner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <!-- ゲーム→結果へ遷移するときのフラッシュ演出 -->
    <div id="transition-overlay" class="transition-overlay hidden"></div>

    <div class="app-root">
      <!-- ===== Start screen ===== -->
      <div id="view-select" class="view view-select active">
        <header class="select-header">
          <button id="settings-btn" class="settings-btn">Settings</button>
        </header>

        <main class="select-main">
          <section class="stage-card">
            <div class="select-hero">
              <img src="poop.png" alt="Poop icon" class="select-hero-img" />
            </div>

            <div class="select-copy">
              <p class="select-desc">
                Dash through the city and collect poop.<br />
                Your title changes depending on how much you pick up!
              </p>
              <button id="start-btn" class="stage-btn">START RUN</button>
            </div>
          </section>
        </main>
      </div>

      <!-- ===== Game view ===== -->
      <div id="view-game" class="view view-game">
        <header class="game-header">
          <button id="back-to-select" class="back-link">← Back</button>
        </header>

        <main class="game-main">
          <div class="game-frame">
            <div class="canvas-shell">
              <canvas id="gameCanvas"></canvas>

              <!-- center message -->
              <div id="center-message" class="center-message hidden"></div>

              <!-- top-left status -->
              <div id="top-left-status" class="top-left-status">
                Poops: 0
              </div>
            </div>

            <div class="hud-row bottom-info">
              <div id="bottom-left" class="bottom-text"></div>
              <div id="bottom-center" class="bottom-text"></div>
              <div id="bottom-right" class="bottom-text"></div>
            </div>
          </div>
        </main>
      </div>

      <!-- ===== Result view ===== -->
      <div id="view-result" class="view view-result">
        <header class="result-header">
          <button id="back-to-select-result" class="back-link">← Back</button>
        </header>

        <main class="result-main">
          <div class="result-frame">
            <h1 class="result-rank-title">
              RANK: <span id="result-rank" class="result-rank-value">F</span>
            </h1>

            <section class="result-panel">
              <h2 id="result-label" class="result-main-label">lolol</h2>
              <p id="result-score" class="result-count">
                Poops collected: 0
              </p>

              <h3 class="result-best-title">Best Runs</h3>
              <ul id="result-best-list" class="result-best-list">
                <!-- JSで中身を生成 -->
              </ul>
            </section>

            <button id="result-restart-btn" class="primary-btn result-btn">
              Play Again
            </button>
          </div>
        </main>
      </div>
    </div>

    <!-- ===== Player Settings Modal ===== -->
    <div id="settings-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <h2 class="modal-title">Player Settings</h2>

        <label class="modal-field">
          <span class="modal-label">Player name</span>
          <input
            id="setting-name"
            type="text"
            maxlength="20"
            placeholder="Your name"
          />
        </label>

        <div class="modal-field">
          <span class="modal-label">Avatar</span>
          <div class="avatar-row">
            <div class="avatar-preview-wrap">
              <!-- 設定されていないときは CSS のデフォルト影アイコン -->
              <div id="avatar-preview" class="avatar-preview"></div>
            </div>

            <div class="avatar-buttons">
              <button id="avatar-file-btn" type="button" class="small-btn">
                Choose Image
              </button>
              <input
                id="avatar-file-input"
                type="file"
                accept="image/*"
                class="hidden"
              />

              <button id="avatar-camera-btn" type="button" class="small-btn">
                Take Photo
              </button>
            </div>
          </div>

          <div class="camera-area hidden" id="camera-area">
            <video
              id="avatar-camera-video"
              autoplay
              playsinline
              class="camera-video"
            ></video>
            <div class="camera-buttons">
              <button
                id="avatar-camera-capture"
                type="button"
                class="small-btn primary-small"
              >
                Capture
              </button>
              <button
                id="avatar-camera-cancel"
                type="button"
                class="small-btn"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button id="settings-save" type="button" class="primary-btn small">
            Save
          </button>
          <button id="settings-cancel" type="button" class="secondary-btn small">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- ===== BGM / SE ===== -->
    <!-- 3ページそれぞれ別のBGMファイルを用意してね -->
    <audio id="bgm-home" src="bgm_home.mp3" preload="auto" loop></audio>
    <audio id="bgm-game" src="bgm_game.mp3" preload="auto" loop></audio>
    <audio id="bgm-result" src="bgm_result.mp3" preload="auto" loop></audio>

    <audio id="se-jump" src="se_jump.mp3" preload="auto"></audio>
    <audio id="se-gameover" src="se_gameover.mp3" preload="auto"></audio>

    <!-- game script -->
    <script src="./game.js"></script>
  </body>
</html>
